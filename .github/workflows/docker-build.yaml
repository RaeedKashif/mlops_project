name: Build Docker Images

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Debug info
      run: |
        echo "✅ Workflow started!"
        echo "Event: ${{ github.event_name }}"
        echo "Branch: ${{ github.ref }}"
    
    - name: Build ingestion service
      run: |
        cd ingestion
        docker build -t ingestion-service:latest .
    
    - name: Build publisher
      run: |
        cd publisher
        docker build -t publisher:latest .
    
    - name: Build dashboard
      run: |
        cd streamlit_app
        docker build -t dashboard:latest .
    
    - name: Build FL server
      run: |
        cd federated_learning
        docker build -t fl-server:latest .
    
    - name: Success
      run: echo "✅ All images built successfully!"